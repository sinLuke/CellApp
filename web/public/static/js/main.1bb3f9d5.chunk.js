(window["webpackJsonpcell-app-react"]=window["webpackJsonpcell-app-react"]||[]).push([[0],{204:function(e,t,a){e.exports=a(358)},209:function(e,t,a){},358:function(e,t,a){"use strict";a.r(t);var s=a(0),i=a.n(s),n=a(55),l=a.n(n);a(209),Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));a(210);var o=a(194),r=a(25),c=a(26),p=a(28),d=a(27),u=a(20),h=a(29),m=a(19),g=a.n(m),E=g.a.initializeApp({apiKey:"AIzaSyBM-C_d1o-gVCFRQykdbBI4svOSed8JbDY",authDomain:"cell-app.firebaseapp.com",databaseURL:"https://cell-app.firebaseio.com",projectId:"cell-app",storageBucket:"cell-app.appspot.com",messagingSenderId:"854633007097",appId:"1:854633007097:web:0f1cadc2d35c247e2fdf28",measurementId:"G-3ZZ2QEG61Z"}),b=a(54),f=a(47),v=a(374),U=function(){return i.a.createElement(v.a,{fixed:"top"},i.a.createElement(v.a.Item,null,i.a.createElement(b.b,{to:"/",onClick:function(){g.a.auth().signOut()}},"Sign Out")),i.a.createElement(v.a.Item,{to:"/home"},i.a.createElement(b.b,null,"Home")))},O=a(177),S=a.n(O),L=a(376),C=a(377),I=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(p.a)(this,Object(d.a)(t).call(this,e))).state={user:g.a.auth().currentUser},g.a.auth().onAuthStateChanged(function(e){e?(console.log("set user",e),this.setState({user:e})):(console.log("set user",null),this.setState({user:null}))}.bind(Object(u.a)(a))),a}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){if(this.state.user)return i.a.createElement(f.a,{to:"/home"});var e={signInFlow:"popup",callbacks:{signInSuccessWithAuthResult:function(e,t){return!1}},signInOptions:[g.a.auth.GoogleAuthProvider.PROVIDER_ID,g.a.auth.EmailAuthProvider.PROVIDER_ID]};return i.a.createElement("div",null,i.a.createElement(L.a,{container:!0,stackable:!0,verticalAlign:"top"},i.a.createElement(L.a.Row,null,i.a.createElement(L.a.Column,{width:4}),i.a.createElement(L.a.Column,{width:8},i.a.createElement(C.a,{size:"huge",style:{fontWeight:"normal",marginTop:"2em",marginLeft:"2em",marginBottom:"2em"}},"Login"),i.a.createElement(S.a,{uiConfig:e,firebaseAuth:g.a.auth()})),i.a.createElement(L.a.Column,{width:4}))))}}]),t}(i.a.Component),y=a(373),T=a(58),_=a(360),A=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(p.a)(this,Object(d.a)(t).call(this,e))).state={loading:e.loading,type:e.type},a.getCellContent=a.getCellContent.bind(Object(u.a)(a)),a.getAddButtonLabel=a.getAddButtonLabel.bind(Object(u.a)(a)),a.cellClicked=a.cellClicked.bind(Object(u.a)(a)),a}return Object(h.a)(t,e),Object(c.a)(t,[{key:"getCellContent",value:function(e){switch(this.state.type){case 0:return e.TOPIC_NAME;case 1:return e.DOCUMENT_NAME;default:return"Step ".concat(e.PAGE_NUMBER+1)}}},{key:"getAddButtonLabel",value:function(){switch(this.state.type){case 0:return"Add Topic";case 1:return"Add Document";default:return"Add Step"}}},{key:"cellClicked",value:function(e){this.props.setSelected(e)}},{key:"componentWillReceiveProps",value:function(){this.state.loading&&this.setState({loading:!1})}},{key:"render",value:function(){var e=this;return console.log("itemList item prop",this.props.items),i.a.createElement(y.a,{celled:!0,disabled:this.props.isUploading},i.a.createElement(y.a.Header,null,i.a.createElement(y.a.Row,null,i.a.createElement(y.a.HeaderCell,null,this.props.title))),i.a.createElement(y.a.Body,null,this.props.items.map((function(t){return i.a.createElement(y.a.Row,{style:{cursor:"pointer"},key:t.id,onClick:function(){this.props.isUploading||this.cellClicked(t.id)}.bind(e)},e.props.changed.has(t.id)?i.a.createElement(y.a.Cell,{warning:e.props.selected!=t.id,style:{backgroundColor:e.props.selected===t.id?"#007affff":"white",color:e.props.selected===t.id?"white":"black"}},i.a.createElement(T.a,{name:"dot circle outline"}),e.getCellContent(t)):i.a.createElement(y.a.Cell,{style:{backgroundColor:e.props.selected===t.id?"#007affff":"white",color:e.props.selected===t.id?"white":"black"}},e.getCellContent(t)))}))),i.a.createElement(y.a.Footer,{fullWidth:!0},i.a.createElement(y.a.Row,null,i.a.createElement(y.a.HeaderCell,{colSpan:"4"},i.a.createElement(_.a,{floated:"left",icon:!0,labelPosition:"right",size:"small",primary:!0,loading:this.state.loading,disabled:this.state.loading,onClick:function(){this.state.loading||(this.setState({loading:!0}),this.props.add())}.bind(this)},i.a.createElement(T.a,{name:"add"})," ",this.getAddButtonLabel())))))}}]),t}(i.a.Component),k=a(375),M=a(193),D=a(372),N=a(368),j=a(369),w=a(370),R=a(192),P=a(371),G=a(67),F=a.n(G),H=function(e){function t(e){return Object(r.a)(this,t),Object(p.a)(this,Object(d.a)(t).call(this,e))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=Object(M.a)(new Array(this.props.stepCount).keys()).map((function(e){return{key:e,text:"Page ".concat(e+1),value:e}}));console.log("topicList",this.props);var t=Object.values(this.props.documentList).map(function(e){return this.props.topicList[e.TOPIC_ID]?{key:e.id,text:"".concat(this.props.topicList[e.TOPIC_ID].TOPIC_NAME," - ").concat(e.DOCUMENT_NAME),value:e.id}:{key:e.id,text:"".concat(e.DOCUMENT_NAME),value:e.id}}.bind(this)).sort((function(e,t){return e.text>t.text?-1:e.text<t.text?1:0}));return i.a.createElement(y.a,{celled:!0},i.a.createElement(y.a.Header,null,i.a.createElement(y.a.Row,null,i.a.createElement(y.a.HeaderCell,null,this.props.title))),i.a.createElement(y.a.Body,null,i.a.createElement(y.a.Row,null,i.a.createElement(y.a.Cell,null,i.a.createElement(D.a,null,i.a.createElement(D.a.Group,{widths:"equal"},i.a.createElement(D.a.Field,{id:"step-detail-id-field",control:N.a,label:"Step ID",value:this.props.step.id,disabled:!0})),i.a.createElement(D.a.Group,{widths:"equal"},i.a.createElement(D.a.Field,{options:t,control:j.a,label:{children:"In Document",htmlFor:"step-detail-document-id"},value:this.props.step.DOCUMENT_ID,onChange:function(e,t){var a=t.value;this.props.setKeyValue("DOCUMENT_ID",a)}.bind(this),disabled:!0})),i.a.createElement(D.a.Group,{widths:"equal"},i.a.createElement(D.a.Field,{options:e,control:j.a,label:{children:"Page Number",htmlFor:"step-detail-page-number-field"},value:this.props.step.PAGE_NUMBER,onChange:function(e,t){var a=t.value;this.props.setKeyValue("PAGE_NUMBER",a)}.bind(this)}),i.a.createElement(D.a.Field,{options:[{key:"auto",text:"Auto",value:1},{key:"interactive",text:"Interactive",value:0}],control:j.a,label:{children:"Animation",htmlFor:"step-detail-animation-field"},value:this.props.step.AUTO_ANIMATION,onChange:function(e,t){var a=t.value;this.props.setKeyValue("AUTO_ANIMATION",a)}.bind(this)})),i.a.createElement(D.a.Field,{id:"step-detail-text-area",control:w.a,label:"Text",value:this.props.step.TEXT,onChange:function(e,t){var a=t.value;this.props.setKeyValue("TEXT",a)}.bind(this)}),i.a.createElement(D.a.Field,{label:"Step Image"}),this.props.step.IMAGE_URL?i.a.createElement(k.a,null,i.a.createElement(R.a,{fluid:!0,src:this.props.step.IMAGE_URL})):" ",this.props.isUploading?i.a.createElement(P.a,{color:"grey",percent:this.props.progress,indicating:!0}):i.a.createElement(D.a.Group,null,i.a.createElement("label",{style:{backgroundColor:"lightGrey",color:"black",marginLeft:8,padding:8,paddingLeft:16,paddingRight:16,borderRadius:4,cursor:"pointer"}},i.a.createElement("b",null,"Upload an Image"),i.a.createElement(F.a,{accept:"image/*",name:"step_image",randomizeFilename:!0,hidden:!0,storageRef:g.a.storage().ref("images"),onUploadStart:function(){this.props.uploadHelpers.handleUploadStart(this.props.step.id)}.bind(this),onUploadError:this.props.uploadHelpers.handleUploadError,onUploadSuccess:function(e){this.props.uploadHelpers.handleUploadSuccess(2,this.props.step.id,e)}.bind(this),onProgress:this.props.uploadHelpers.handleProgress,disabled:this.props.isUploading})),i.a.createElement(D.a.Field,{id:"step-detail-remove-image",control:_.a,content:"Remove Image",color:"red",disabled:!this.props.step.IMAGE_URL||this.props.isUploading,onClick:function(){this.props.setKeyValue("IMAGE_URL",null)}.bind(this)})),i.a.createElement(D.a.Group,{widths:"equal"},i.a.createElement(D.a.Field,{id:"step-detail-image-subtitle-field",control:N.a,label:"Image Subtitle",value:this.props.step.IMAGE_SUBTITLE,onChange:function(e,t){var a=t.value;this.props.setKeyValue("IMAGE_SUBTITLE",a)}.bind(this)})),i.a.createElement(D.a.Field,{id:"step-detail-comform",control:_.a,content:"Save",primary:!0,disabled:!this.props.changed.has(this.props.step.id)||this.props.isUploading,onClick:function(){this.props.uploadHelpers.update(2,this.props.step.id)}.bind(this)}))))))}}]),t}(i.a.Component),V=function(e){function t(e){return Object(r.a)(this,t),Object(p.a)(this,Object(d.a)(t).call(this,e))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=Object.values(this.props.topicList).map((function(e){return{key:e.id,text:e.TOPIC_NAME,value:e.id}}));return i.a.createElement(y.a,{celled:!0},i.a.createElement(y.a.Header,null,i.a.createElement(y.a.Row,null,i.a.createElement(y.a.HeaderCell,null,this.props.title))),i.a.createElement(y.a.Body,null,i.a.createElement(y.a.Row,null,i.a.createElement(y.a.Cell,null,i.a.createElement(D.a,null,i.a.createElement(D.a.Group,{widths:"equal"},i.a.createElement(D.a.Field,{id:"document-detail-id-field",control:N.a,label:"Document ID",value:this.props.document.id,disabled:!0})),i.a.createElement(D.a.Group,{widths:"equal"},i.a.createElement(D.a.Field,{id:"document-detail-name-field",control:N.a,label:"Document Name",value:this.props.document.DOCUMENT_NAME,onChange:function(e,t){var a=t.value;this.props.setKeyValue("DOCUMENT_NAME",a)}.bind(this)})),i.a.createElement(D.a.Group,{widths:"equal"},i.a.createElement(D.a.Field,{options:e,control:j.a,label:{children:"In Topic",htmlFor:"document-detail-topic-id"},value:this.props.document.TOPIC_ID,onChange:function(e,t){var a=t.value;this.props.setKeyValue("TOPIC_ID",a)}.bind(this)})),i.a.createElement(D.a.Group,{widths:"equal"},i.a.createElement(D.a.Field,{id:"document-detail-difficulty-field",control:N.a,label:"Difficulty",value:this.props.document.DIFFICULTY,onChange:function(e,t){var a=t.value;Number.isInteger(a)&&(a<1?this.props.setKeyValue("DIFFICULTY",0):this.props.setKeyValue("DIFFICULTY",a))}.bind(this)})),i.a.createElement(D.a.Field,{id:"document-detail-text-area",control:w.a,label:"Introduction",value:this.props.document.INTRODUCTION,onChange:function(e,t){var a=t.value;this.props.setKeyValue("INTRODUCTION",a)}.bind(this)}),i.a.createElement(D.a.Field,{label:"Document Image"}),this.props.document.IMAGE_URL?i.a.createElement(k.a,null,i.a.createElement(R.a,{fluid:!0,src:this.props.document.IMAGE_URL})):" ",this.props.isUploading?i.a.createElement(P.a,{color:"grey",percent:this.props.progress,indicating:!0}):i.a.createElement(D.a.Group,null,i.a.createElement("label",{style:{backgroundColor:"lightGrey",color:"black",marginLeft:8,padding:8,paddingLeft:16,paddingRight:16,borderRadius:4,cursor:"pointer"}},i.a.createElement("b",null,"Upload an Image"),i.a.createElement(F.a,{accept:"image/*",name:"document_image",randomizeFilename:!0,hidden:!0,storageRef:g.a.storage().ref("images"),onUploadStart:function(){this.props.uploadHelpers.handleUploadStart(this.props.document.id)}.bind(this),onUploadError:this.props.uploadHelpers.handleUploadError,onUploadSuccess:function(e){this.props.uploadHelpers.handleUploadSuccess(1,this.props.document.id,e)}.bind(this),onProgress:this.props.uploadHelpers.handleProgress,disabled:this.props.isUploading})),i.a.createElement(D.a.Field,{id:"document-detail-remove-image",control:_.a,content:"Remove Image",color:"red",disabled:!this.props.document.IMAGE_URL||this.props.isUploading,onClick:function(){this.props.setKeyValue("IMAGE_URL",null)}.bind(this)})),i.a.createElement(D.a.Field,{id:"step-detail-comform",control:_.a,content:"Save",primary:!0,disabled:!this.props.changed.has(this.props.document.id)||this.props.isUploading,onClick:function(){this.props.uploadHelpers.update(1,this.props.document.id)}.bind(this)}))))))}}]),t}(i.a.Component),B=function(e){function t(e){return Object(r.a)(this,t),Object(p.a)(this,Object(d.a)(t).call(this,e))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return i.a.createElement(y.a,{celled:!0},i.a.createElement(y.a.Header,null,i.a.createElement(y.a.Row,null,i.a.createElement(y.a.HeaderCell,null,this.props.title))),i.a.createElement(y.a.Body,null,i.a.createElement(y.a.Row,null,i.a.createElement(y.a.Cell,null,i.a.createElement(D.a,null,i.a.createElement(D.a.Group,{widths:"equal"},i.a.createElement(D.a.Field,{id:"topic-detail-id-field",control:N.a,label:"Topic ID",value:this.props.topic.id,disabled:!0})),i.a.createElement(D.a.Group,{widths:"equal"},i.a.createElement(D.a.Field,{id:"step-detail-image-subtitle-field",control:N.a,label:"Topic Name",value:this.props.topic.TOPIC_NAME,onChange:function(e,t){var a=t.value;this.props.setKeyValue("TOPIC_NAME",a)}.bind(this)})),i.a.createElement(D.a.Field,{label:"Topic Image"}),this.props.topic.IMAGE_URL?i.a.createElement(k.a,null,i.a.createElement(R.a,{fluid:!0,src:this.props.topic.IMAGE_URL})):" ",this.props.isUploading?i.a.createElement(P.a,{color:"grey",percent:this.props.progress,indicating:!0}):i.a.createElement(D.a.Group,null,i.a.createElement("label",{style:{backgroundColor:"lightGrey",color:"black",marginLeft:8,padding:8,paddingLeft:16,paddingRight:16,borderRadius:4,cursor:"pointer"}},i.a.createElement("b",null,"Upload an Image"),i.a.createElement(F.a,{accept:"image/*",name:"topic_image",randomizeFilename:!0,hidden:!0,storageRef:g.a.storage().ref("images"),onUploadStart:function(){this.props.uploadHelpers.handleUploadStart(this.props.topic.id)}.bind(this),onUploadError:this.props.uploadHelpers.handleUploadError,onUploadSuccess:function(e){this.props.uploadHelpers.handleUploadSuccess(0,this.props.topic.id,e)}.bind(this),onProgress:this.props.uploadHelpers.handleProgress,disabled:this.props.isUploading})),i.a.createElement(D.a.Field,{id:"step-detail-remove-image",control:_.a,content:"Remove Image",color:"red",disabled:!this.props.topic.IMAGE_URL||this.props.isUploading,onClick:function(){this.props.setKeyValue("IMAGE_URL",null)}.bind(this)})),i.a.createElement(D.a.Field,{id:"step-detail-comform",control:_.a,content:"Save",primary:!0,disabled:!this.props.changed.has(this.props.topic.id)||this.props.isUploading,onClick:function(){this.props.uploadHelpers.update(0,this.props.topic.id)}.bind(this)}))))))}}]),t}(i.a.Component),K=function(e){function t(e){return Object(r.a)(this,t),Object(p.a)(this,Object(d.a)(t).call(this,e))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return this.props.topicSelected?this.props.documentSelected?this.props.stepSelected?i.a.createElement(H,{step:this.props.lists.stepList[this.props.stepSelected],stepCount:this.props.filterStepList(this.props.documentSelected).length,title:"".concat(this.props.lists.documentList[this.props.documentSelected].DOCUMENT_NAME," - Step ").concat(this.props.lists.stepList[this.props.stepSelected].PAGE_NUMBER),changed:this.props.changed,uploadHelpers:this.props.uploadHelpers,setKeyValue:function(e,t){this.props.setKeyValue(2,this.props.stepSelected,this.props.documentSelected,e,t)}.bind(this),isUploading:this.props.isUploading,progress:this.props.progress,documentList:this.props.lists.documentList,topicList:this.props.lists.topicList}):i.a.createElement(V,{document:this.props.lists.documentList[this.props.documentSelected],changed:this.props.changed,title:"".concat(this.props.lists.documentList[this.props.documentSelected].DOCUMENT_NAME),uploadHelpers:this.props.uploadHelpers,setKeyValue:function(e,t){this.props.setKeyValue(1,this.props.documentSelected,this.props.topicSelected,e,t)}.bind(this),isUploading:this.props.isUploading,progress:this.props.progress,topicList:this.props.lists.topicList}):i.a.createElement(B,{topic:this.props.lists.topicList[this.props.topicSelected],changed:this.props.changed,uploadHelpers:this.props.uploadHelpers,title:"".concat(this.props.lists.topicList[this.props.topicSelected].TOPIC_NAME),setKeyValue:function(e,t){this.props.setKeyValue(0,this.props.topicSelected,null,e,t)}.bind(this),isUploading:this.props.isUploading,progress:this.props.progress}):i.a.createElement(k.a,{disabled:!0,textAlign:"center"},"Select anything on the left")}}]),t}(i.a.Component),x=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(p.a)(this,Object(d.a)(t).call(this,e))).state={user:g.a.auth().currentUser,admin:!1,topic:null,document:null,step:null,edit:!1},g.a.auth().onAuthStateChanged(function(e){e?(this.setState({user:e}),e.email&&this.setState({admin:"yinluke@gmail.com"===g.a.auth().currentUser.email||"yinluke@gmail.com2"===g.a.auth().currentUser.email})):this.setState({user:null})}.bind(Object(u.a)(a))),a.filterDocumentList=a.filterDocumentList.bind(Object(u.a)(a)),a.filterStepList=a.filterStepList.bind(Object(u.a)(a)),a}return Object(h.a)(t,e),Object(c.a)(t,[{key:"filterDocumentList",value:function(e){return Object.values(this.props.lists.documentList).filter((function(t){return t.TOPIC_ID===e}))}},{key:"filterStepList",value:function(e){return Object.values(this.props.lists.stepList).filter((function(t){return t.DOCUMENT_ID===e}))}},{key:"render",value:function(){var e=this;return this.state.user?this.state.admin?i.a.createElement("div",null,i.a.createElement(L.a,{container:!0,stackable:!0,columns:"equal",verticalAlign:"top"},i.a.createElement(L.a.Row,{stretched:!0,style:{marginTop:"4em"}},i.a.createElement(L.a.Column,null,i.a.createElement(A,{selected:this.props.topicSelected,setSelected:function(t){return e.props.setSelected(0,t)},items:Object.values(this.props.lists.topicList).sort((function(e,t){return e.created<t.created?-1:e.created>t.created?1:0})),title:"Topics",add:function(){return e.props.add(0,null)},loading:!1,type:0,changed:this.props.changed,isUploading:this.props.isUploading,progress:this.props.progress})),this.props.topicSelected?i.a.createElement(L.a.Column,null,i.a.createElement(A,{selected:this.props.documentSelected,setSelected:function(t){return e.props.setSelected(1,t)},items:this.filterDocumentList(this.props.topicSelected).sort((function(e,t){return e.created<t.created?-1:e.created>t.created?1:0})),title:this.props.lists.topicList[this.props.topicSelected]?this.props.lists.topicList[this.props.topicSelected].TOPIC_NAME:"Docuemnt",add:function(t){return e.props.add(1,e.props.topicSelected)},loading:!1,type:1,changed:this.props.changed,isUploading:this.props.isUploading,progress:this.props.progress})):" ",this.props.documentSelected?i.a.createElement(L.a.Column,null,i.a.createElement(A,{selected:this.props.stepSelected,setSelected:function(t){return e.props.setSelected(2,t)},items:this.filterStepList(this.props.documentSelected).sort((function(e,t){return e.PAGE_NUMBER<t.PAGE_NUMBER?-1:e.PAGE_NUMBER>t.PAGE_NUMBER?1:0})),title:this.props.lists.documentList[this.props.documentSelected].DOCUMENT_NAME,add:function(t){return e.props.add(2,e.props.documentSelected)},loading:!1,type:2,changed:this.props.changed,isUploading:this.props.isUploading,progress:this.props.progress})):" ",i.a.createElement(L.a.Column,{width:8},i.a.createElement(K,{topicSelected:this.props.topicSelected,documentSelected:this.props.documentSelected,stepSelected:this.props.stepSelected,lists:this.props.lists,add:this.props.add,filterStepList:this.filterStepList,changed:this.props.changed,setKeyValue:this.props.setKeyValue,uploadHelpers:this.props.uploadHelpers,isUploading:this.props.isUploading,progress:this.props.progress}))))):i.a.createElement("div",{style:{margin:"4em"}},i.a.createElement(k.a,null,this.state.user.displayName," is not an administrator")):i.a.createElement(f.a,{to:"/"})}}]),t}(i.a.Component),q=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(p.a)(this,Object(d.a)(t).call(this,e))).state={topic:null,document:null,step:null,topicList:{},stepList:{},documentList:{},currentVersion:null,changed:new Set,isUploading:null,progress:0},a.setSelected=a.setSelected.bind(Object(u.a)(a)),a.load=a.load.bind(Object(u.a)(a)),a.add=a.add.bind(Object(u.a)(a)),a.setKeyValue=a.setKeyValue.bind(Object(u.a)(a)),a.uploadHelpers={handleUploadStart:a.handleUploadStart.bind(Object(u.a)(a)),handleProgress:a.handleProgress.bind(Object(u.a)(a)),handleUploadError:a.handleUploadError.bind(Object(u.a)(a)),handleUploadSuccess:a.handleUploadSuccess.bind(Object(u.a)(a)),update:a.update.bind(Object(u.a)(a))},a.db=E.firestore(),a.load(),a}return Object(h.a)(t,e),Object(c.a)(t,[{key:"handleUploadStart",value:function(e){this.setState({isUploading:e,progress:0})}},{key:"handleProgress",value:function(e){this.setState({progress:e})}},{key:"handleUploadError",value:function(e){this.setState({isUploading:null}),window.alert(e)}},{key:"handleUploadSuccess",value:function(e,t,a){g.a.storage().ref("images").child(a).getDownloadURL().then(function(a){var s=this.state.changed;switch(s.add(t),e){case 0:if(this.state.topicList[t]){var i=this.state.topicList;i[t].IMAGE_URL=a,this.setState({topicList:i,progress:100,isUploading:null,changed:s})}case 1:if(this.state.documentList[t]){var n=this.state.documentList;n[t].IMAGE_URL=a,this.setState({documentList:n,progress:100,isUploading:null,changed:s})}default:if(this.state.stepList[t]){var l=this.state.stepList;l[t].IMAGE_URL=a,this.setState({stepList:l,progress:100,isUploading:null,changed:s})}}}.bind(this))}},{key:"setSelected",value:function(e,t){switch(e){case 0:Object.keys(this.state.topicList).includes(t)?(console.log(1),this.setState({topic:t,document:null,step:null})):(console.log(2),this.setState({topic:null,document:null,step:null}));break;case 1:if(Object.keys(this.state.documentList).includes(t)){var a=this.state.documentList[t].TOPIC_ID;Object.keys(this.state.topicList).includes(a)?(console.log(3),this.setState({topic:a,document:t,step:null})):(console.log(4),this.setState({topic:null,document:null,step:null}))}else console.log(5),this.setState({document:null,step:null});break;default:if(Object.keys(this.state.stepList).includes(t)){var s=this.state.stepList[t].DOCUMENT_ID;if(Object.keys(this.state.documentList).includes(s)){a=this.state.documentList[s].TOPIC_ID;Object.keys(this.state.topicList).includes(a)?this.setState({topic:a,document:s,step:t}):(console.log(6),this.setState({topic:null,document:null,step:null}))}else console.log(7),this.setState({document:null,step:null})}else console.log(8,this.state.stepList,t),this.setState({step:null})}}},{key:"setKeyValue",value:function(e,t,a,s,i){var n=this.state.changed;switch(console.log("setKeyValue",this.state.stepList[t]),e){case 0:if("TOPIC",!this.state.topicList[t])return;var l=this.state.topicList;l[t][s]=i,n.add(t),this.setState({topicList:l,changed:n});break;case 1:if("DOCUMENT",!this.state.documentList[t])return;var o=this.state.documentList,r=this.state.topic;if("TOPIC_ID"===s){if(!this.state.topicList[i])return;console.log("_topic 1",r,i),r=i,console.log("_topic 2",r,i)}o[t][s]=i,n.add(t),console.log("_topic 3",r,s,i),this.setState({documentList:o,changed:n,topic:r});break;default:if("STEP",!this.state.stepList[t])return;var c=this.state.stepList;if("PAGE_NUMBER"===s)return void Object.values(c).forEach(function(e){if(e.DOCUMENT_ID===a&&e.PAGE_NUMBER===i){if(e.id==t)return;var s=c[t].PAGE_NUMBER;return c[e.id].PAGE_NUMBER=s,c[t].PAGE_NUMBER=i,void Promise.all([this.db.collection("STEP").doc(e.id).update({PAGE_NUMBER:s}),this.db.collection("STEP").doc(t).update({PAGE_NUMBER:i})]).then(function(){this.setState({stepList:c})}.bind(this))}}.bind(this));var p=this.state.document;r=this.state.topic;if("DOCUMENT_ID"===s){if(!this.state.documentList[i])return;if(!this.state.topicList[this.state.documentList[i].TOPIC_ID])return;p=i,r=this.state.documentList[i].TOPIC_ID}c[t][s]=i,n.add(t),this.setState({stepList:c,changed:n,document:p,topic:r}),console.log("setKeyValue",this.state.stepList[t])}}},{key:"add",value:function(e,t){var a="TOPIC",s=null;switch(e){case 0:a="TOPIC",s={IMAGE_URL:null,TOPIC_NAME:"New Topic",created:(new Date).getTime()};break;case 1:a="DOCUMENT",s={DIFFICULTY:1,DOCUMENT_NAME:"New Document",IMAGE_URL:null,INTRODUCTION:"Add Introduction Here ...",TOPIC_ID:t,available_scope:10,created:(new Date).getTime()};break;default:a="STEP",s={AUTO_ANIMATION:1,DOCUMENT_ID:t,IMAGE_SUBTITLE:"Subtitle",IMAGE_URL:null,TEXT:"Add Text Here ...",PAGE_NUMBER:Object.values(this.state.stepList).filter((function(e){return e.DOCUMENT_ID===t})).length,created:(new Date).getTime()}}this.db.collection(a).add(s).then(function(t){switch(s.id=t.id,this.db.collection("var").doc("db_version").set({value:this.state.currentVersion+1}),e){case 0:var a=this.state.topicList;a[t.id]=s,this.setState({topic:t.id,topicList:a});break;case 1:var i=this.state.documentList;i[t.id]=s,this.setState({document:t.id,documentList:i});break;default:var n=this.state.stepList;n[t.id]=s,this.setState({step:t.id,stepList:n})}}.bind(this))}},{key:"update",value:function(e,t){console.trace("update");var a="TOPIC",s=null;switch(e){case 0:a="TOPIC",s=this.state.topicList[t];break;case 1:a="DOCUMENT",s=this.state.documentList[t];break;default:a="STEP",s=this.state.stepList[t]}console.trace("update",s),s&&this.db.collection(a).doc(t).set(s).then(function(){this.db.collection("var").doc("db_version").set({value:this.state.currentVersion+1});var e=this.state.changed;e.delete(t),this.setState({changed:e})}.bind(this))}},{key:"load",value:function(){console.log("load");var e={},t={},a={};Promise.all([this.db.collection("TOPIC").get(),this.db.collection("DOCUMENT").get(),this.db.collection("STEP").get()]).then(function(s){var i=Object(o.a)(s,3),n=i[0],l=i[1],r=i[2];n.forEach((function(t){var a=t.data();a.id=t.id,e[t.id]=a})),l.forEach((function(e){var t=e.data();t.id=e.id,a[e.id]=t})),r.forEach((function(e){var a=e.data();a.id=e.id,t[e.id]=a})),this.setState({topicList:e,documentList:a,stepList:t,changed:new Set})}.bind(this))}},{key:"render",value:function(){var e=this;return i.a.createElement(b.a,null,i.a.createElement("div",null,i.a.createElement(U,null),i.a.createElement("hr",null),i.a.createElement(f.b,{exact:!0,path:"/",render:function(e){return i.a.createElement(I,null)}}),i.a.createElement(f.b,{path:"/home",render:function(t){return i.a.createElement(x,{setSelected:e.setSelected,topicSelected:e.state.topic,documentSelected:e.state.document,stepSelected:e.state.step,lists:{topicList:e.state.topicList,documentList:e.state.documentList,stepList:e.state.stepList},update:e.update,load:e.load,add:e.add,setKeyValue:e.setKeyValue,changed:e.state.changed,uploadHelpers:e.uploadHelpers,isUploading:e.state.isUploading,progress:e.state.progress})}})))}}]),t}(i.a.Component),z=a(378);window.onbeforeunload=function(e){console.log("onbeforeunload"),e.preventDefault(),e.returnValue="Really want to quit the game?"},document.onkeydown=function(e){if((e=e||window.event).ctrlKey)switch(e.which||e.keyCode){case 83:case 87:e.preventDefault(),e.stopPropagation()}},l.a.render(i.a.createElement(z.a,null,i.a.createElement(q,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[204,1,2]]]);
//# sourceMappingURL=main.1bb3f9d5.chunk.js.map